#!/bin/bash
# Block PRs by preventing pushes to arbitrary feature branches.
# Horde agents push to main (clan) or raider/* branches (raiders).
# PRs are for external contributors only.

# Allowed patterns:
#   main, relics-sync  - Direct work branches
#   raider/*           - Raider working branches (Forge merges these)

while read local_ref local_sha remote_ref remote_sha; do
  branch="${remote_ref#refs/heads/}"

  case "$branch" in
    main|relics-sync|raider/*)
      # Allowed branches
      ;;
    *)
      echo "ERROR: Invalid branch for Horde agents."
      echo ""
      echo "Blocked push to: $branch"
      echo ""
      echo "Allowed branches:"
      echo "  main        - Clan workers push here directly"
      echo "  raider/*    - Raider working branches"
      echo "  relics-sync - Relics synchronization"
      echo ""
      echo "Do NOT create PRs. Push to main or let Forge merge raider work."
      exit 1
      ;;
  esac
done

exit 0
