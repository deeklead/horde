description = """
Warchief bootstraps Horde via a verification-gated lifecycle totem.

## Purpose
When Warchief executes \"boot up gas encampment\", this proto provides the workflow.
Each step has action + verification - steps stay open until outcome is confirmed.

## Key Principles
1. **Verification-gated steps** - Not \"command ran\" but \"outcome confirmed\"
2. **hd peek for verification** - Capture session output to detect stalls
3. **hd signal for recovery** - Reliable message delivery to unstick agents
4. **Parallel where possible** - Witnesses and refineries can start in parallel
5. **Ephemeral execution** - Boot is a wisp, squashed to digest after completion

## Execution
```bash
bd mol wisp totem-horde-boot  # Create wisp
```"""
ritual = "totem-horde-boot"
version = 1

[[steps]]
description = """
Verify the Horde daemon is running.

## Action
```bash
hd daemon status || hd daemon start
```

## Verify
1. Daemon PID file exists: `~/.gt/daemon.pid`
2. Process is alive: `kill -0 $(cat ~/.gt/daemon.pid)`
3. Daemon responds: `hd daemon status` returns success

## OnFail
Cannot start daemon. Log error and continue - some commands work without daemon."""
id = "ensure-daemon"
title = "Ensure daemon"

[[steps]]
description = """
Start the Shaman and verify scout mode is active.

## Action
```bash
hd shaman start
```

## Verify
1. Session exists: `tmux has-session -t hq-shaman 2>/dev/null`
2. Not stalled: `hd peek shaman/` does NOT show \"> Try\" prompt
3. Heartbeat fresh: `shaman/heartbeat.json` modified < 2 min ago

## OnStall
```bash
hd signal shaman/ \"Start scout.\"
sleep 30
# Re-verify
```"""
id = "ensure-shaman"
needs = ["ensure-daemon"]
title = "Ensure shaman"

[[steps]]
description = """
Parallel container: Start all warband witnesses.

Children execute in parallel. Container completes when all children complete."""
id = "ensure-witnesses"
needs = ["ensure-shaman"]
title = "Ensure witnesses"
type = "parallel"

[[steps.children]]
description = """
Start the horde warband Witness.

## Action
```bash
hd witness start horde
```

## Verify
1. Session exists: `tmux has-session -t horde-witness 2>/dev/null`
2. Not stalled: `hd peek horde/witness` does NOT show \"> Try\" prompt
3. Heartbeat fresh: Last scout cycle < 5 min ago"""
id = "ensure-horde-witness"
title = "Ensure horde witness"

[[steps.children]]
description = """
Start the relics warband Witness.

## Action
```bash
hd witness start relics
```

## Verify
1. Session exists: `tmux has-session -t relics-witness 2>/dev/null`
2. Not stalled: `hd peek relics/witness` does NOT show \"> Try\" prompt
3. Heartbeat fresh: Last scout cycle < 5 min ago"""
id = "ensure-relics-witness"
title = "Ensure relics witness"

[[steps]]
description = """
Parallel container: Start all warband refineries.

Children execute in parallel. Container completes when all children complete."""
id = "ensure-refineries"
needs = ["ensure-shaman"]
title = "Ensure refineries"
type = "parallel"

[[steps.children]]
description = """
Start the horde warband Forge.

## Action
```bash
hd forge start horde
```

## Verify
1. Session exists: `tmux has-session -t horde-forge 2>/dev/null`
2. Not stalled: `hd peek horde/forge` does NOT show \"> Try\" prompt
3. Queue processing: Forge can receive merge requests"""
id = "ensure-horde-forge"
title = "Ensure horde forge"

[[steps.children]]
description = """
Start the relics warband Forge.

## Action
```bash
hd forge start relics
```

## Verify
1. Session exists: `tmux has-session -t relics-forge 2>/dev/null`
2. Not stalled: `hd peek relics/forge` does NOT show \"> Try\" prompt
3. Queue processing: Forge can receive merge requests"""
id = "ensure-relics-forge"
title = "Ensure relics forge"

[[steps]]
description = """
Final verification that Horde is healthy.

## Action
```bash
hd status
```

## Verify
1. Daemon running: Shows daemon status OK
2. Shaman active: Shows shaman in scout mode
3. All witnesses: Each warband witness shows active
4. All refineries: Each warband forge shows active

## OnFail
Log degraded state but consider boot complete. Some agents may need manual recovery.
Run `hd doctor` for detailed diagnostics."""
id = "verify-encampment-health"
needs = ["ensure-witnesses", "ensure-refineries"]
title = "Verify encampment health"

